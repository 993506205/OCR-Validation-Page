{% extends 'base.html' %}

{% load humanize %}

{% block title %}
  | Account Dashboard
{% endblock title %}

{% block content %}
    <section id="showcase-inner" class="py-5 text-white">
    <div class="container">
      <div class="row text-center">
        <div class="col-md-12">
          <h1 class="display-4">User Dashboard</h1>
          <p class="lead">Manage your account</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Breadcrumb -->
  <section id="bc" class="mt-3">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="{% url 'index' %}">
              <i class="fas fa-home"></i> Home</a>
          </li>
          <li class="breadcrumb-item active"> Dashboard</li>
        </ol>
      </nav>
    </div>
  </section>
    <!-- Alerts -->
    {% include 'partials/_alerts.html' %}

  <section id="dashboard" class="py-4">
    <div class="bs-docs-header" id="content" tabindex="-1"></div>
      <div class="container"> 
        <div class="col-md-12">
          <h2>Welcome {% if user.is_authenticated %}{{ user.username }}{% endif %}</h2>
          
          <table class="table">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Description</th>
              <th></th>      
            </tr>
          </thead>
          <tbody id="proj_list">
          {% if dir_project %}

            {% for dir in dir_project %}
              <tr>
                <td>{{ dir.name }}</td>
                <td>{{ dir.description }}</td>
                <td>
                  <button id="{{ dir.id }}" class="btn btn-sm btn-danger" type="button" onclick="DeletePro(this)">Delete</button>
                </td>
              </tr>
            {% endfor %}
          
          {% endif %}
          </tbody>
        </table>
        <br>
        <small class="text-muted">Last Login: {% if user.is_authenticated %}{{ user.last_login|naturaltime }}{% endif %}</small>
        </div>
      </div>
    </div>
  </section>

<script type="text/javascript">
  function DeletePro(x){
    var token = '{{csrf_token}}';
    var dir_id = x.id;
    var r = confirm("Are you sure to delete?");
    if(r == true){
      $.ajax({ 
            headers: { "X-CSRFToken": token },
            url: '{% url 'dashboard' %}',
            data: JSON.stringify({ dir_id: dir_id }),
            type: 'POST',
            contentType : 'application/json',
        }).done(function(responseData) {
            $('#proj_list').load('{% url 'dashboard' %} #proj_list')
            console.log('Done');
        }).fail(function() {
            console.log('Failed');
        });
    }
  }
</script>

{% endblock content %}

